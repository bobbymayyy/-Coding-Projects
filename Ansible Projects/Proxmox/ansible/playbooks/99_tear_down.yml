---
- name: System tear down for Proxmox
  hosts: prox
  tasks:
    - name: Remove fedora container
      community.general.proxmox:
        vmid: 102
        api_host: {{ ansible_host }}
        api_user: root@pam
        api_password: 1qaz2wsx!QAZ@WSX
        state: stopped
    - name: Remove fedora container
      community.general.proxmox:
        vmid: 102
        api_host: {{ ansible_host }}
        api_user: root@pam
        api_password: 1qaz2wsx!QAZ@WSX
        state: absent
    - name: Gather storage information from Proxmox
      ansible.builtin.command: pvesm zfsscan
      register: zpool
    - name: Print storage information from Proxmox
      ansible.builtin.debug: msg="Your zfs pool is {{ zpool.stdout }}"
    - name: Remove zfs device from zpool
      ansible.builtin.command: pvesm remove {{ item }}
      with_items:
      - ansible
      ignore_errors: true
    - name: Check on progress
      ansible.builtin.command: pvesm status
      register: zfsstatus
    - name: Print status
      ansible.builtin.debug: msg="{{ zfsstatus.stdout_lines }}"